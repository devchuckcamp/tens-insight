# Docker Compose for Tens-Insight
# Connects to existing GoInsight postgres container

services:
  tens-insight:
    build: .
    container_name: tens-insight
    environment:
      - DATABASE_URL=${DATABASE_URL:-postgresql://goinsight:goinsight_dev_pass@goinsight-postgres:5432/goinsight?sslmode=disable}
      - MODELS_DIR=${MODELS_DIR:-/app/models}
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - BATCH_SIZE=${BATCH_SIZE:-32}
      - EPOCHS=${EPOCHS:-50}
      - VALIDATION_SPLIT=${VALIDATION_SPLIT:-0.2}
      - SCORE_BATCH_SIZE=${SCORE_BATCH_SIZE:-1000}
      - RANDOM_SEED=${RANDOM_SEED:-42}
    volumes:
      - ./models:/app/models  # Persist trained models
      - ./src:/app/src        # Mount source for development
    networks:
      - goinsight_default
    # Run setup by default, then wait
    command: python setup.py

networks:
  goinsight_default:
    external: true
